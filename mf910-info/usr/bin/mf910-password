#!/bin/bash
# $1 = target interface
# $2 = new wifi password
# $3 = new admin password

INTERFACE=$1
NEWWIFI=$2
NEWADMIN=$3

. /usr/bin/mf910-common

echo -n "Login... "
login

if [ "$WIFIKEY" != "$NEWWIFI" ]; then
  echo -n "Updating wifi password... "
  setcmd 'isTest=false&goformId=SET_WIFI_MULTI_BAND_SETTINGS&isTest=false&m_ssid_enable=0&m_band_enable=0&wifi_multi_band_set=1&security_mode=WPAPSKWPA2PSK&ssid='$IMEI'&wifi_band=b&cipher=1&security_shared_mode=1&passphrase='$( encode $NEWWIFI) -H 'Referer: http://'$MODEM'/index.html'
fi

if [ "$ADMINKEY" != "$NEWADMIN" ]; then
  echo -n "Updating management password... "
  setcmd 'newPassword='$(encode $NEWADMIN)'&oldPassword='$(encode $ADMINKEY)'&goformId=CHANGE_PASSWORD&isTest=false'
fi

echo "WIFIKEY=$NEWWIFI" > /etc/default/mifi.$IMEI
echo "ADMINKEY=$NEWADMIN" >> /etc/default/mifi.$IMEI
